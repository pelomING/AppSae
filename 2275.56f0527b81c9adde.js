"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2275],{2275:(Y,h,s)=>{s.r(h),s.d(h,{Tab1PageModule:()=>S});var n=s(9843),b=s(6814),c=s(95),v=s(2881),d=s(5861),T=s(7838),y=s(7793),o=s(9468),I=s(5517),_=s(7696),Z=s(7519);function P(i,r){if(1&i&&(o.TgZ(0,"ion-select-option",12),o._uU(1),o.qZA()),2&i){const a=r.$implicit;o.Q6J("value",a.codigo),o.xp6(1),o.Oqu(a.nombre)}}function x(i,r){if(1&i&&(o.TgZ(0,"ion-select-option",12),o._uU(1),o.qZA()),2&i){const a=r.$implicit;o.Q6J("value",a.codigo),o.xp6(1),o.Oqu(a.horario)}}function F(i,r){if(1&i&&(o.TgZ(0,"ion-select-option",12),o._uU(1),o.qZA()),2&i){const a=r.$implicit;o.Q6J("value",a.patente),o.xp6(1),o.Oqu(a.patente)}}function A(i,r){if(1&i&&(o.TgZ(0,"ion-select-option",12),o._uU(1),o.qZA()),2&i){const a=r.$implicit;o.Q6J("value",a.rut_ayudante),o.xp6(1),o.Oqu(a.nombre)}}const O=[{path:"",component:(()=>{var i;class r{constructor(e,t,l,g,m,f,p){this.indexdbService=e,this.usuarioService=t,this.turnosaeIndexdbService=l,this.formBuilder=g,this.toastController=m,this.loadingCtrl=f,this.platform=p,this.listaAyudantes=[],this.listaOficinas=[],this.listaVehiculos=[],this.listaTurnos=[],this.turnosae=new y.b,this.miFormulario=this.formBuilder.group({id:[""],codigo_oficina:["",c.kI.required],codigo_turno:["",c.kI.required],patente_vehiculo:["",c.kI.required],rut_ayudante:["",c.kI.required],km_inicia:["",c.kI.required]})}ngOnInit(){this.indexdbService.openDatabase().then(e=>{this.db=e,console.log("INICIO BASE DE DATOS"),this.ObtenerRegistrodeTurno(),this.loadItemsFromIndexDB()}).catch(e=>{console.error("Error al inicializar la base de datos:",e)})}ObtenerRegistrodeTurno(){this.turnosaeIndexdbService.getTurnosae(1).then(t=>{t?this.miFormulario.patchValue({id:t.id,codigo_oficina:t.codigo_oficina,codigo_turno:t.codigo_turno,patente_vehiculo:t.patente_vehiculo,rut_ayudante:t.rut_ayudante,km_inicia:t.km_inicia}):console.log("No se encontr\xf3 el turno con ID 1")}).catch(t=>{console.error("Error al obtener el turno:",t)})}presentToast(e){var t=this;return(0,d.Z)(function*(){yield(yield t.toastController.create({message:e,duration:2e3,position:"bottom"})).present()})()}loadItemsFromIndexDB(){var e=this;return(0,d.Z)(function*(){const t=["ayudantes","oficinas","vehiculos","turnos"];for(const l of t)yield e.loadItems(l)})()}loadItems(e){var t=this;return(0,d.Z)(function*(){try{const l=yield t.indexdbService.getAllFromIndex(e);console.log("Items",l),t.assignItemsToList(e,l),console.log(`${e} obtenidos:`,l)}catch(l){console.error(`Error al obtener ${e}:`,l)}})()}assignItemsToList(e,t){switch(e){case"ayudantes":this.listaAyudantes=t;break;case"oficinas":this.listaOficinas=t,console.log("cargar datos en oficina",this.listaOficinas);break;case"vehiculos":this.listaVehiculos=t;break;case"turnos":this.listaTurnos=t}}guardarInicioTurno(){var e=this;return(0,d.Z)(function*(){var t;if(null!==(t=e.miFormulario)&&void 0!==t&&t.valid){const l=yield e.loadingCtrl.create({message:"Guardando..."});l.present();try{yield e.obtenerUbicacion();const{id:g,codigo_oficina:m,codigo_turno:f,patente_vehiculo:p,rut_ayudante:J,km_inicia:C}=e.miFormulario.value;console.log("Id del registro creado : ",g),yield e.usuarioService.cargarRut_User();const u=new y.b({rut_maestro:e.usuarioService.rut_user,rut_ayudante:J,codigo_turno:f,patente_vehiculo:p,codigo_oficina:m,km_inicia:C,fecha_hora_inicio:new Date,fecha_hora_final:new Date,fechaSistema:new Date,estadoEnvio:0,latitude:e.latitude,longitude:e.longitude});if(g>0){u.id=g;let N=e.turnosaeIndexdbService.getTurnosae(u.id);u.km_final=(yield N).km_final,e.turnosaeIndexdbService.actualizarTurnosae(u).then(()=>{console.log("Datos Actualizados en IndexDB:",u)})}else u.id=1,e.turnosaeIndexdbService.guardarTurnosae(u).then(()=>{console.log("Datos guardados en IndexDB:",u)});e.ObtenerRegistrodeTurno(),yield e.presentToast("Los datos se guardaron con \xe9xito")}catch{}finally{l.dismiss()}}else console.log("Formulario inv\xe1lido. Por favor, complete todos los campos."),yield e.presentToast("Formulario inv\xe1lido. Por favor, complete todos los campos.")})()}solicitarPermisosDeGeolocalizacion(){var e=this;return(0,d.Z)(function*(){if(e.platform.is("hybrid"))try{yield T.b.requestPermissions()}catch(t){console.error("Error al solicitar permisos de geolocalizaci\xf3n:",t)}else console.warn("La geolocalizaci\xf3n no est\xe1 disponible en la plataforma web.")})()}obtenerUbicacion(){var e=this;return(0,d.Z)(function*(){try{const t=yield T.b.getCurrentPosition();e.latitude=t.coords.latitude.toString(),e.longitude=t.coords.longitude.toString(),console.log("Ubicaci\xf3n obtenida:",t)}catch(t){console.error("Error al obtener la ubicaci\xf3n:",t)}})()}}return(i=r).\u0275fac=function(e){return new(e||i)(o.Y36(I.p),o.Y36(_.i),o.Y36(Z.N),o.Y36(c.qu),o.Y36(n.yF),o.Y36(n.HT),o.Y36(n.t4))},i.\u0275cmp=o.Xpm({type:i,selectors:[["app-tab1"]],decls:26,vars:7,consts:[[3,"translucent"],[1,"ion-padding",3,"fullscreen"],[3,"formGroup"],["formControlName","codigo_oficina","label","Oficina","label-placement","floating","fill","outline"],[3,"value",4,"ngFor","ngForOf"],["formControlName","codigo_turno","label","Turno","label-placement","floating","fill","outline"],["formControlName","patente_vehiculo","label","Vehiculo","label-placement","floating","fill","outline"],["formControlName","rut_ayudante","label","Ayudante","label-placement","floating","fill","outline"],["type","number","formControlName","km_inicia","label","KM Inicial","label-placement","floating","fill","outline","placeholder","Ingresar km inicial"],["id","open-loading","expand","full","color","primary",1,"bottom-button",3,"click"],["slot","start","name","save"],["type","hidden","formControlName","id"],[3,"value"]],template:function(e,t){1&e&&(o.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),o._uU(3," Inicio de Turno "),o.qZA()()(),o.TgZ(4,"ion-content",1)(5,"ion-card")(6,"ion-card-content")(7,"form",2)(8,"ion-select",3),o.YNc(9,P,2,2,"ion-select-option",4),o.qZA(),o._UZ(10,"br"),o.TgZ(11,"ion-select",5),o.YNc(12,x,2,2,"ion-select-option",4),o.qZA(),o._UZ(13,"br"),o.TgZ(14,"ion-select",6),o.YNc(15,F,2,2,"ion-select-option",4),o.qZA(),o._UZ(16,"br"),o.TgZ(17,"ion-select",7),o.YNc(18,A,2,2,"ion-select-option",4),o.qZA(),o._UZ(19,"br")(20,"ion-input",8)(21,"br"),o.TgZ(22,"ion-button",9),o.NdJ("click",function(){return t.guardarInicioTurno()}),o._UZ(23,"ion-icon",10),o._uU(24," Guardar"),o.qZA(),o._UZ(25,"ion-input",11),o.qZA()()()()),2&e&&(o.Q6J("translucent",!0),o.xp6(4),o.Q6J("fullscreen",!0),o.xp6(3),o.Q6J("formGroup",t.miFormulario),o.xp6(2),o.Q6J("ngForOf",t.listaOficinas),o.xp6(3),o.Q6J("ngForOf",t.listaTurnos),o.xp6(3),o.Q6J("ngForOf",t.listaVehiculos),o.xp6(3),o.Q6J("ngForOf",t.listaAyudantes))},dependencies:[n.YG,n.PM,n.FN,n.W2,n.Gu,n.gu,n.pK,n.t9,n.n0,n.wd,n.sr,n.as,n.QI,n.j9,b.sg,c._Y,c.JJ,c.JL,c.sg,c.u],styles:['@charset "UTF-8";.bottom-button[_ngcontent-%COMP%]{bottom:120px;right:120px}']}),r})()}];let U=(()=>{var i;class r{}return(i=r).\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({imports:[v.Bz.forChild(O),v.Bz]}),r})(),S=(()=>{var i;class r{}return(i=r).\u0275fac=function(e){return new(e||i)},i.\u0275mod=o.oAB({type:i}),i.\u0275inj=o.cJS({imports:[n.Pc,b.ez,c.u5,c.UX,U]}),r})()}}]);