"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3667],{3667:(H,p,a)=>{a.r(p),a.d(p,{ViewEventosaePageModule:()=>A});var m=a(6814),P=a(95),r=a(9843),v=a(2881),h=a(5861),e=a(9468),f=a(2377),x=a(5517),E=a(7830),b=a(9862),C=a(6306),M=a(6232),y=a(553),S=a(7024),O=a(2014),T=a(7696);const I=y.N.url;let _=(()=>{var o;class s{constructor(t,n,c,d,u){this.http=t,this.storage=n,this.indexdbService=c,this.usuarioService=d,this.eventoSaeIndexdb=u,this.token="",this.eventoSaeModel=new S.k,this.indexdbService.openDatabase().then(l=>{this.db=l,console.log("INICIO BASE DE DATOS EN EVENTOS-SAE")}).catch(l=>{console.error("Error al inicializar la base de datos:",l)})}formatearFecha(t){return(0,f.Z)(t,"dd/MM/yyyy HH:mm")}EnviarEvento(t){var n=this;return(0,h.Z)(function*(){const c={num_ot:t.numero_ot.toString(),tipo_evento:t.tipo_evento.toString(),rut_maestro:t.rut_maestro,rut_ayudante:t.rut_ayudante,codigo_turno:t.codigo_turno,codigo_oficina:t.codigo_oficina,requerimiento:t.requerimiento,hora_inicio:t.hora_inicio,hora_termino:t.hora_termino,direccion:t.direccion,fecha_hora_ejecucion:n.formatearFecha(t.fecha_hora_ejecucion),latitude:t.latitude,longitude:t.longitude};return yield n.usuarioService.cargarToken(),n.token=n.usuarioService.token,new Promise(d=>{const u=new b.WM({Authorization:`Bearer ${n.token}`});console.log("DATOS EVENTOS SAE:",c),n.http.post(`${I}/eventos-sae`,c,{headers:u,observe:"response"}).pipe((0,C.K)(l=>(d(!1),console.error("Error en la solicitud HTTP eventos-sae:",l.error.message),M.E))).subscribe(function(){var l=(0,h.Z)(function*(g){const U=g.status,N=g.headers;console.log("responseBody:",g.body),console.log("status:",U),console.log("headers:",N),g?(t.estadoEnvio=1,n.eventoSaeIndexdb.actualizarEventoSae(t).then(()=>{console.log("Datos Actualizados en IndexDB:",t)}),d(!0)):d(!1)});return function(g){return l.apply(this,arguments)}}())})})()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.LFG(b.eN),e.LFG(O.K),e.LFG(x.p),e.LFG(T.i),e.LFG(E._))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),s})();var w=a(1327),Z=a(4734);function B(o,s){1&o&&e._UZ(0,"ion-icon",18)}function z(o,s){if(1&o){const i=e.EpF();e.TgZ(0,"ion-content",4)(1,"ion-card")(2,"ion-card-content")(3,"ion-item"),e._UZ(4,"div",1),e.TgZ(5,"ion-label",5)(6,"h2"),e._uU(7),e.TgZ(8,"span",6)(9,"ion-note",7),e._uU(10),e.qZA(),e.YNc(11,B,1,0,"ion-icon",8),e.qZA()()()(),e.TgZ(12,"div",9),e._UZ(13,"ion-input",10)(14,"br")(15,"ion-input",11)(16,"br")(17,"ion-input",12)(18,"br")(19,"ion-input",13)(20,"br")(21,"ion-input",14)(22,"br")(23,"ion-input",15),e.qZA(),e._UZ(24,"br"),e.TgZ(25,"ion-button",16),e.NdJ("click",function(){e.CHM(i);const n=e.oxw();return e.KtG(n.enviarEventoaMongoDb())}),e._UZ(26,"ion-icon",17),e._uU(27," Enviar"),e.qZA()()()()}if(2&o){const i=e.oxw();e.Q6J("fullscreen",!0),e.xp6(4),e.Tol(0===i.eventosae.estadoEnvio?"dot dot-active":"dot dot-unread"),e.xp6(3),e.hij(" ",i.eventosae.numero_ot," "),e.xp6(3),e.Oqu(i.formatearFecha(i.eventosae.fecha_hora_ejecucion)),e.xp6(1),e.Q6J("ngIf",i.isIos()),e.xp6(2),e.s9C("value",i.tipo_evento),e.xp6(2),e.s9C("value",i.comuna),e.xp6(2),e.s9C("value",i.eventosae.direccion),e.xp6(2),e.s9C("value",i.eventosae.requerimiento),e.xp6(2),e.s9C("value",i.eventosae.hora_inicio),e.xp6(2),e.s9C("value",i.eventosae.hora_termino),e.xp6(2),e.Q6J("disabled",0!==i.eventosae.estadoEnvio)}}const V=[{path:"",component:(()=>{var o;class s{isIos(){return this.platform.is("ios")}constructor(t,n,c,d,u,l){this.navCtrl=t,this.uiService=n,this.sharedService=c,this.loadingCtrl=d,this.cdr=u,this.route=l,this.activatedRoute=(0,e.f3M)(v.gz),this.platform=(0,e.f3M)(r.t4),this.indexDBService=(0,e.f3M)(x.p),this.eventoSaeIndexdb=(0,e.f3M)(E._),this.eventoSaeService=(0,e.f3M)(_)}ngOnInit(){this.indexDBService.openDatabase().then(()=>this.buscarEventoforId()).catch(t=>{console.error("Error al inicializar la base de datos:",t)})}buscarTipoEvento(t){this.indexDBService.getTipoEventoByCodigo(t).then(n=>{this.tipo_evento=n.codigo}).catch(n=>{console.error("Error al obtener los eventos:",n)})}buscarComuna(t){this.indexDBService.getComunaByCodigo(t).then(n=>{this.comuna=n.nombre}).catch(n=>{console.error("Error al obtener los eventos:",n)})}buscarEventoforId(){const t=this.activatedRoute.snapshot.paramMap.get("id");console.log("buscarEventoforId : ",t),this.eventoSaeIndexdb.getEventoSae(parseInt(t,10)).then(n=>{this.eventosae=n,this.buscarTipoEvento(this.eventosae.tipo_evento),this.buscarComuna(this.eventosae.codigo_comuna),console.log("Registro encontrado :",n)}).catch(n=>{console.error("Error al obtener los eventos:",n)})}getBackButtonText(){return this.platform.is("ios")?"Inbox":""}goToPaginaPrincipal(){this.sharedService.triggerUpdateCargarEventos()}formatearFecha(t){return(0,f.Z)(t,"dd/MM/yyyy HH:mm")}enviarEventoaMongoDb(){var t=this;return(0,h.Z)(function*(){const n=yield t.loadingCtrl.create({message:"Enviando..."});n.present();try{console.log("Enviando Datos desde Evento");const c=yield t.eventoSaeService.EnviarEvento(t.eventosae);console.log("VALIDO",c),c&&(t.uiService.alertaInformativa("Este registro ha sido enviado al servidor"),t.sharedService.triggerUpdateCargarEventos(),t.navCtrl.navigateBack("/main/tabs/tab2",{animated:!0})),0==c&&t.uiService.alertaInformativa("No es posible conectar con el servidor intentar m\xe1s tarde")}catch{}finally{n.dismiss()}})()}}return(o=s).\u0275fac=function(t){return new(t||o)(e.Y36(r.SH),e.Y36(w.y),e.Y36(Z.F),e.Y36(r.HT),e.Y36(e.sBO),e.Y36(v.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-view-eventosae"]],decls:6,vars:3,consts:[[3,"translucent"],["slot","start"],[3,"text","click"],[3,"fullscreen",4,"ngIf"],[3,"fullscreen"],[1,"ion-text-wrap"],[1,"date"],[1,"small-font"],["aria-hidden","true","name","chevron-forward","size","small",4,"ngIf"],[1,"ion-padding"],["type","text","label","Tipo Evento","readonly","true","label-placement","floating","fill","solid","placeholder","",3,"value"],["type","text","label","Comuna","readonly","true","label-placement","floating","fill","solid","placeholder","",3,"value"],["type","text","label","Direcci\xf3n","readonly","true","label-placement","floating","fill","solid","placeholder","",3,"value"],["type","text","label","Trabajo Solicitado","readonly","true","label-placement","floating","fill","solid","placeholder","",3,"value"],["type","text","label","Hora Inicio","readonly","true","label-placement","floating","fill","solid","placeholder","",3,"value"],["type","text","label","Hora Termino","readonly","true","label-placement","floating","fill","solid","placeholder","",3,"value"],["id","open-loading","expand","full","color","primary",1,"bottom-button",3,"disabled","click"],["slot","start","name","send"],["aria-hidden","true","name","chevron-forward","size","small"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-back-button",2),e.NdJ("click",function(){return n.goToPaginaPrincipal()}),e.qZA()(),e._uU(4," Envio de Evento "),e.qZA()(),e.YNc(5,z,28,13,"ion-content",3)),2&t&&(e.Q6J("translucent",!0),e.xp6(3),e.Q6J("text",n.getBackButtonText()),e.xp6(2),e.Q6J("ngIf",n.eventosae))},dependencies:[m.O5,r.oU,r.YG,r.Sm,r.PM,r.FN,r.W2,r.Gu,r.gu,r.pK,r.Ie,r.Q$,r.uN,r.sr,r.j9,r.cs],styles:['@charset "UTF-8";ion-item[_ngcontent-%COMP%]{--inner-padding-end: 0;--background: transparent}ion-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:600}ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:42px;margin-right:8px}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:12px;margin-right:12px;font-weight:400}h1[_ngcontent-%COMP%]{margin:0;font-weight:700;font-size:22px}p[_ngcontent-%COMP%]{line-height:22px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}ion-label[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px}ion-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:600;margin:0}ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;width:95%}ion-item[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{float:right;align-items:center;display:flex}ion-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#c9c9ca}ion-item[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%]{font-size:15px;margin-right:8px;font-weight:400}ion-item[_ngcontent-%COMP%]   ion-note.md[_ngcontent-%COMP%]{margin-right:14px}.dot[_ngcontent-%COMP%]{display:block;height:12px;width:12px;border-radius:50%;align-self:start;margin:16px 10px 16px 16px}.dot-unread[_ngcontent-%COMP%]{background:var(--ion-color-primary)}.dot-read[_ngcontent-%COMP%]{background:var(--ion-color-secondary)}.dot-active[_ngcontent-%COMP%]{background:var(--ion-color-success)}.small-font[_ngcontent-%COMP%]{font-size:10px}ion-footer[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-size:11px;font-weight:400}']}),s})()}];let F=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[v.Bz.forChild(V),v.Bz]}),s})(),A=(()=>{var o;class s{}return(o=s).\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[m.ez,P.u5,r.Pc,F]}),s})()}}]);